<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review">

    <!-- 게시글 전체목록 조회 및 검색 조회까지 -->
    <select id="listAll" resultType="com.multi.cookies.board.dto.ReviewDTO">
        select review_id, review_img, review_title, member_id, create_dt, review_score
        from review_bbs
<!--        <include refid="search"></include>-->
        ORDER BY review_id DESC, create_dt DESC
    </select>

<!--
    &lt;!&ndash; 1-2. 게시글 레코드 갯수 &ndash;&gt;
    <select id="countArticle" resultType="int">
        SELECT COUNT(*) FROM review_bbs
        &lt;!&ndash; WHERE절을 include 태그로 삽입 &ndash;&gt;
        <include refid="search"></include>
    </select>

    &lt;!&ndash; sql code 조각 &ndash;&gt;
    &lt;!&ndash; 반복되는 sql의 일부를 sql태그를 이용하여 따로 빼둘수 있다. &ndash;&gt;
    <sql id="search">
        <choose>
            &lt;!&ndash; 검색옵션이 전체 검색일 경우 &ndash;&gt;
            <when test="searchOption == 'all'">
                WHERE review_title like '%'||#{keyword}||'%'
                OR member_id like '%'||#{keyword}||'%'

            </when>
            &lt;!&ndash; 전체 검색이 아닐 경우 &ndash;&gt;
            <otherwise>
                WHERE ${searchOption} like '%'||#{keyword}||'%'
            </otherwise>
        </choose>
    </sql>
-->





    <!-- 게시물 작성 -->
    <insert id="insert">
        INSERT INTO review_bbs(review_title , review_score, review_content, review_img, member_id)
        VALUES(#{review_title}, #{review_score}, #{review_content}, #{review_img}, #{member_id})

    </insert>

    <!-- 게시물 조회 -->
    <select id="view" parameterType="int" resultType="reviewDTO">
        SELECT *
        FROM review_bbs
        WHERE review_id = #{review_id}
    </select>

    <!-- 게시물 수정 -->
    <update id="updateArticle" parameterType="reviewDTO">
        UPDATE review_bbs
        SET
            review_title = #{review_title},
            review_score = #{review_score},
            review_content = #{review_content},
            review_img = #{review_img}
        WHERE review_id = #{review_id}
    </update>

    <!-- 게시물 삭제 -->
    <delete id="deleteArticle" parameterType="int">
        DELETE FROM review_bbs
        WHERE review_id = #{review_id}
    </delete>




</mapper>